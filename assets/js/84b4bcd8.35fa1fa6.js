"use strict";(self.webpackChunkcluster_docs=self.webpackChunkcluster_docs||[]).push([[6822],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var i=a.createContext({}),u=function(e){var t=a.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},c=function(e){var t=u(e.components);return a.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,s=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=u(r),m=n,g=d["".concat(i,".").concat(m)]||d[m]||p[m]||s;return r?a.createElement(g,l(l({ref:t},c),{},{components:r})):a.createElement(g,l({ref:t},c))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=r.length,l=new Array(s);l[0]=d;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o.mdxType="string"==typeof e?e:n,l[1]=o;for(var u=2;u<s;u++)l[u]=r[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},5162:(e,t,r)=>{r.d(t,{Z:()=>l});var a=r(7294),n=r(6010);const s="tabItem_Ymn6";function l(e){let{children:t,hidden:r,className:l}=e;return a.createElement("div",{role:"tabpanel",className:(0,n.Z)(s,l),hidden:r},t)}},5488:(e,t,r)=>{r.d(t,{Z:()=>m});var a=r(7462),n=r(7294),s=r(6010),l=r(2389),o=r(7392),i=r(7094),u=r(2466);const c="tabList__CuJ",p="tabItem_LNqP";function d(e){var t;const{lazy:r,block:l,defaultValue:d,values:m,groupId:g,className:f}=e,b=n.Children.map(e.children,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),v=m??b.map((e=>{let{props:{value:t,label:r,attributes:a}}=e;return{value:t,label:r,attributes:a}})),h=(0,o.l)(v,((e,t)=>e.value===t.value));if(h.length>0)throw new Error(`Docusaurus error: Duplicate values "${h.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const k=null===d?d:d??(null==(t=b.find((e=>e.props.default)))?void 0:t.props.value)??b[0].props.value;if(null!==k&&!v.some((e=>e.value===k)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${k}" but none of its children has the corresponding value. Available values are: ${v.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:w}=(0,i.U)(),[z,N]=(0,n.useState)(k),O=[],{blockElementScrollPositionUntilNextRender:C}=(0,u.o5)();if(null!=g){const e=y[g];null!=e&&e!==z&&v.some((t=>t.value===e))&&N(e)}const E=e=>{const t=e.currentTarget,r=O.indexOf(t),a=v[r].value;a!==z&&(C(t),N(a),null!=g&&w(g,String(a)))},T=e=>{var t;let r=null;switch(e.key){case"Enter":E(e);break;case"ArrowRight":{const t=O.indexOf(e.currentTarget)+1;r=O[t]??O[0];break}case"ArrowLeft":{const t=O.indexOf(e.currentTarget)-1;r=O[t]??O[O.length-1];break}}null==(t=r)||t.focus()};return n.createElement("div",{className:(0,s.Z)("tabs-container",c)},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":l},f)},v.map((e=>{let{value:t,label:r,attributes:l}=e;return n.createElement("li",(0,a.Z)({role:"tab",tabIndex:z===t?0:-1,"aria-selected":z===t,key:t,ref:e=>O.push(e),onKeyDown:T,onClick:E},l,{className:(0,s.Z)("tabs__item",p,null==l?void 0:l.className,{"tabs__item--active":z===t})}),r??t)}))),r?(0,n.cloneElement)(b.filter((e=>e.props.value===z))[0],{className:"margin-top--md"}):n.createElement("div",{className:"margin-top--md"},b.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==z})))))}function m(e){const t=(0,l.Z)();return n.createElement(d,(0,a.Z)({key:String(t)},e))}},8135:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>u,toc:()=>p});var a=r(7462),n=(r(7294),r(3905)),s=r(5488),l=r(5162);const o={id:"providers-azure",title:"Azure",sidebar_label:"Azure",sidebar_position:1,tags:["Azure"]},i="Azure",u={unversionedId:"providers/providers-azure",id:"providers/providers-azure",title:"Azure",description:"Cluster access",source:"@site/docs/providers/azure.mdx",sourceDirName:"providers",slug:"/providers/providers-azure",permalink:"/cluster-docs/docs/providers/providers-azure",draft:!1,editUrl:"https://github.com/nimbit-software/cluster-docs/blob/master/docs/providers/azure.mdx",tags:[{label:"Azure",permalink:"/cluster-docs/docs/tags/azure"}],version:"current",sidebarPosition:1,frontMatter:{id:"providers-azure",title:"Azure",sidebar_label:"Azure",sidebar_position:1,tags:["Azure"]},sidebar:"clusterDocs",previous:{title:"Providers",permalink:"/cluster-docs/docs/category/providers"},next:{title:"AWS",permalink:"/cluster-docs/docs/providers/providers-aws"}},c={},p=[{value:"Cluster access",id:"cluster-access",level:2},{value:"Install azure cli",id:"install-azure-cli",level:3},{value:"Get Cluster config",id:"get-cluster-config",level:3},{value:"Creating a cluster",id:"creating-a-cluster",level:2},{value:"Storage classes",id:"storage-classes",level:2}],d={toc:p};function m(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"azure"},"Azure"),(0,n.kt)("h2",{id:"cluster-access"},"Cluster access"),(0,n.kt)("h3",{id:"install-azure-cli"},"Install azure cli"),(0,n.kt)("p",null,"In order to be able to import he cluster config we need to install the cli"),(0,n.kt)(s.Z,{mdxType:"Tabs"},(0,n.kt)(l.Z,{value:"windows",label:"Windows",default:!0,mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=powershell",title:"powershell"},"  $ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri https://aka.ms/installazurecliwindows -OutFile .\\AzureCLI.msi; Start-Process msiexec.exe -Wait -ArgumentList '/I AzureCLI.msi /quiet'; rm .\\AzureCLI.msi\n")))),(0,n.kt)("p",null,"After installing the azure cli we need to add the AKS plugins "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title='aks plugins'",title:"'aks","plugins'":!0},"az aks install-cli\n")),(0,n.kt)("p",null,"Now we are all set "),(0,n.kt)("h3",{id:"get-cluster-config"},"Get Cluster config"),(0,n.kt)("p",null,"To get our cluster config we first need to login to azure "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=login",title:"login"},"az login\n")),(0,n.kt)("p",null,"This will open a login window where we can perform the login."),(0,n.kt)("p",null,"Configure kubectl to connect to your Kubernetes cluster using the ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/cli/azure/aks#az-aks-get-credentials"},"az aks get-credentials")," command. The following command:"),(0,n.kt)("p",null,"Downloads credentials and configures the Kubernetes CLI to use them.\nUses ~/.kube/config, the default location for the ",(0,n.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/"},"Kubernetes configuration")," file. Specify a different location for your Kubernetes configuration file using --file argument."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="azure cli"',title:'"azure','cli"':!0},"az aks get-credentials --resource-group <myResourceGroup> --name <myAKSCluster>\n")),(0,n.kt)("h2",{id:"creating-a-cluster"},"Creating a cluster"),(0,n.kt)("p",null,"The easiest way to create a cluster is to use the cli "),(0,n.kt)("p",null,"Here is a basic example of how to create cluster. There are many more options available for more details see the ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/cli/azure/aks?view=azure-cli-latest#az-aks-create"},"AKS docs")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"az aks create \\\n  -g myResourceGroup \\ \n  -n myAKSCluster \\ \n  --enable-managed-identity \\\n  --node-count 1 \\\n  --node-vm-size Standard_DS2_v2 \\\n  --enable-addons monitoring \\\n  --enable-msi-auth-for-monitoring  \\\n  --kubernetes-version 1.24.6  \\\n  --generate-ssh-keys\n")),(0,n.kt)("h2",{id:"storage-classes"},"Storage classes"),(0,n.kt)("p",null,"Storage classes are important when using persistent volumes. Azure provides a wide variety of storage classes when the cluster is created, but the standard reclaim policy is always set to delete. If we want our volume to remain after the pod has been deleted then we need to create our own storage classes."),(0,n.kt)("p",null,"We will be defining two storage classes."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"managed-csi-retain"),(0,n.kt)("li",{parentName:"ul"},"managed-csi-premium-retain")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="storage classes"',title:'"storage','classes"':!0},"kubectl apply -f - <<EOF\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: managed-csi-premium-retain\nallowVolumeExpansion: true\nparameters:\n  skuname: Premium_LRS\nprovisioner: disk.csi.azure.com\nreclaimPolicy: Retain\nvolumeBindingMode: WaitForFirstConsumer\n---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: managed-csi-retain\nallowVolumeExpansion: true\nparameters:\n  skuname: StandardSSD_LRS\nprovisioner: disk.csi.azure.com\nreclaimPolicy: Retain\nvolumeBindingMode: WaitForFirstConsumer\n\n\nEOF\n\n")))}m.isMDXComponent=!0}}]);